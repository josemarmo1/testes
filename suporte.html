<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Help Amado — Suporte</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Plus+Jakarta+Sans:wght@600;800&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --laranja:#ff6b00; --roxo:#6a1b9a; --cinza-claro:#f5f7fb; --texto:#1f2937; --borda:#e5e7eb; --card:#ffffff;
      --font-heading:'Plus Jakarta Sans',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial,sans-serif;
      --font-body:'Inter',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial,sans-serif;
      --space-field:16px; --space-actions:26px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:#fff;color:var(--texto);font-family:var(--font-body);line-height:1.55}

    /* Cabeçalho */
    header{background:#fff;position:sticky;top:0;z-index:50;border-bottom:1px solid var(--borda)}
    header::after{content:"";display:block;height:3px;background:linear-gradient(90deg,var(--roxo),var(--laranja),var(--roxo));background-size:300% 100%;animation:brandMove 12s linear infinite}
    .header-wrap{display:flex;align-items:center;justify-content:space-between;gap:16px;max-width:1200px;margin:0 auto;padding:14px 20px}
    .logo-text{font-family:var(--font-heading);font-weight:800;font-size:1.5rem;text-decoration:none}
    .logo-orange{color:var(--laranja)} .logo-purple{color:var(--roxo)}
    nav a{text-decoration:none;color:var(--texto);margin-left:18px;font-weight:600;opacity:.85;position:relative}
    nav a:hover{color:var(--laranja);opacity:1}
    nav a.active{color:var(--laranja)}
    nav a::after{content:"";position:absolute;left:0;bottom:-6px;height:2px;width:0;background:currentColor;transition:width .2s ease}
    nav a:hover::after,nav a.active::after{width:100%}

    /* Hero animado */
    .hero{
      position:relative;overflow:hidden;
      background:linear-gradient(120deg, #fff 0%, #fff 30%, #f8efff 60%, #fff 100%);
      padding:56px 20px;
    }
    .hero::before{
      content:"";position:absolute;inset:-40%;background:
        radial-gradient(40% 30% at 20% 20%, rgba(106,27,154,.15), transparent 60%),
        radial-gradient(35% 25% at 80% 30%, rgba(255,107,0,.12), transparent 60%),
        radial-gradient(45% 35% at 50% 80%, rgba(106,27,154,.10), transparent 60%);
      animation:floatBg 16s linear infinite; pointer-events:none;
    }
    @keyframes floatBg{0%{transform:translate3d(0,0,0)}50%{transform:translate3d(-5%, 3%, 0)}100%{transform:translate3d(0,0,0)}}
    .hero .wrap{max-width:1200px;margin:0 auto;text-align:center;position:relative}
    .hero h1{font:800 clamp(1.6rem,3.6vw,2.4rem)/1 var(--font-heading);color:var(--roxo);margin:0 0 10px}
    .hero p{margin:0 0 16px;opacity:.9}

    /* Conteúdo */
    .container{max-width:1200px;margin:0 auto;padding:28px 18px 60px}
    .panel{max-width:560px;margin:0 auto;background:#fff;border:1px solid var(--borda);border-radius:14px;box-shadow:0 1px 2px rgba(0,0,0,.04);overflow:hidden}
    .panel-title{font:800 1.05rem/1.2 var(--font-heading);color:var(--roxo);margin:0;padding:14px 16px;border-bottom:1px solid var(--borda)}
    .panel-body{padding:16px}

    /* Formulário */
    .field{margin-top:var(--space-field)}
    .field:first-of-type{margin-top:0}
    .label{display:block;font-weight:600;margin-bottom:6px}
    .input,.select,.textarea{width:100%;padding:12px;border:1px solid var(--borda);border-radius:10px;background:#fff;font:inherit}
    .textarea{min-height:110px;resize:vertical}
    .actions{margin-top:var(--space-actions)}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 14px;border-radius:10px;border:1px solid transparent;cursor:pointer;font-weight:800;text-decoration:none;transition:transform .15s ease,filter .15s ease}
    .btn:active{transform:scale(.98)}
    .btn-primary{background:var(--laranja);color:#fff}
    .btn-primary:hover{filter:brightness(.96)}
    .muted{font-size:.85rem;opacity:.75;margin-top:6px}
    .hidden{display:none !important}

    /* Rodapé */
    .site-footer{color:#fff;margin-top:40px;position:relative;overflow:hidden;background:linear-gradient(90deg,var(--roxo),var(--laranja),var(--roxo));background-size:300% 100%;animation:brandMove 16s linear infinite}
    .footer-wrap{max-width:1200px;margin:0 auto;padding:18px 20px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .site-footer p{margin:0;font-weight:600}

    @keyframes brandMove{0%{background-position:0% 50%}100%{background-position:300% 50%}}
    @media (prefers-reduced-motion:reduce){header::after,.site-footer,.hero::before{animation:none;background-position:50% 50%}}
  </style>
</head>
<body>
  <header>
    <div class="header-wrap">
      <a href="index.html" class="logo-text logo-link" aria-label="Voltar para Início">
        <span class="logo-orange">Help</span> <span class="logo-purple">Amado</span>
      </a>
      <nav aria-label="Navegação principal">
        <a href="index.html">Início</a>
        <a href="manuais.html">Manuais</a>
        <a class="active" href="suporte.html" aria-current="page">Suporte</a>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="wrap">
      <h1>Suporte Técnico</h1>
      <p>Informe seus dados e do equipamento para iniciarmos o atendimento.</p>
    </div>
  </section>

  <main class="container">
    <article class="panel" aria-label="Formulário de chamado técnico">
      <h3 class="panel-title">Abrir Chamado</h3>
      <div class="panel-body">
        <div class="field">
          <label class="label" for="nome">Nome Completo</label>
          <input class="input" type="text" id="nome" autocomplete="name" />
        </div>

        <div class="field">
          <label class="label" for="escola">Escola / Instituição</label>
          <input class="input" type="text" id="escola" placeholder="Ex.: Escola Municipal XYZ" />
        </div>

        <div class="field">
          <label class="label" for="estado">Estado</label>
          <select class="select" id="estado">
            <option value="">Selecione o estado</option>
            <option value="AC">AC — Acre</option>
            <option value="AL">AL — Alagoas</option>
            <option value="AP">AP — Amapá</option>
            <option value="AM">AM — Amazonas</option>
            <option value="BA">BA — Bahia</option>
            <option value="CE">CE — Ceará</option>
            <option value="DF">DF — Distrito Federal</option>
            <option value="ES">ES — Espírito Santo</option>
            <option value="GO">GO — Goiás</option>
            <option value="MA">MA — Maranhão</option>
            <option value="MT">MT — Mato Grosso</option>
            <option value="MS">MS — Mato Grosso do Sul</option>
            <option value="MG">MG — Minas Gerais</option>
            <option value="PA">PA — Pará</option>
            <option value="PB">PB — Paraíba</option>
            <option value="PR">PR — Paraná</option>
            <option value="PE">PE — Pernambuco</option>
            <option value="PI">PI — Piauí</option>
            <option value="RJ">RJ — Rio de Janeiro</option>
            <option value="RN">RN — Rio Grande do Norte</option>
            <option value="RS">RS — Rio Grande do Sul</option>
            <option value="RO">RO — Rondônia</option>
            <option value="RR">RR — Roraima</option>
            <option value="SC">SC — Santa Catarina</option>
            <option value="SP">SP — São Paulo</option>
            <option value="SE">SE — Sergipe</option>
            <option value="TO">TO — Tocantins</option>
          </select>
          <p id="estadoHint" class="muted">Ao escolher o estado, a lista de cidades será carregada.</p>
        </div>

        <div class="field" id="cidadeField">
          <label class="label" for="cidadeSelect">Cidade</label>
          <select class="select" id="cidadeSelect" disabled>
            <option value="">Selecione o estado primeiro</option>
          </select>

          <!-- Fallback: input com sugestões (capitais) -->
          <input class="input hidden" type="text" id="cidadeInput" placeholder="Digite sua cidade" list="sugestoesCapitais"/>
          <datalist id="sugestoesCapitais"></datalist>

          <p id="cidadeStatus" class="muted"></p>
        </div>

        <div class="field">
          <label class="label" for="equipamento">Equipamento</label>
          <select class="select" id="equipamento">
            <option value="Impressora 3D">Impressora 3D</option>
            <option value="Corte a Laser">Corte a Laser</option>
            <option value="Plotter de Recorte">Plotter de Recorte</option>
            <option value="Tela Interativa">Tela Interativa</option>
            <option value="Notebook Amado">Notebook Amado</option>
          </select>
        </div>

        <div class="field">
          <label class="label" for="serie">Nº de Série</label>
          <input class="input" type="text" id="serie"/>
        </div>

        <div class="actions">
          <button class="btn btn-primary" onclick="enviarWhatsApp()">Enviar pelo WhatsApp</button>
        </div>
      </div>
    </article>
  </main>

  <footer class="site-footer">
    <div class="footer-wrap">
      <p>© 2025 Help Amado — Todos os direitos reservados.</p>
      <p>Atendimento • Segunda a Sexta, horário escolar</p>
    </div>
  </footer>

  <script>
    // Mapa UF -> ID do IBGE
    const UF_IDS = {AC:12, AL:27, AP:16, AM:13, BA:29, CE:23, DF:53, ES:32, GO:52, MA:21, MT:51, MS:50, MG:31, PA:15, PB:25, PR:41, PE:26, PI:22, RJ:33, RN:24, RS:43, RO:11, RR:14, SC:42, SP:35, SE:28, TO:17};

    // Capitais para sugestões no fallback (sempre disponível)
    const CAPITAIS = {
      AC:'Rio Branco', AL:'Maceió', AP:'Macapá', AM:'Manaus', BA:'Salvador', CE:'Fortaleza', DF:'Brasília', ES:'Vitória',
      GO:'Goiânia', MA:'São Luís', MT:'Cuiabá', MS:'Campo Grande', MG:'Belo Horizonte', PA:'Belém', PB:'João Pessoa',
      PR:'Curitiba', PE:'Recife', PI:'Teresina', RJ:'Rio de Janeiro', RN:'Natal', RS:'Porto Alegre', RO:'Porto Velho',
      RR:'Boa Vista', SC:'Florianópolis', SP:'São Paulo', SE:'Aracaju', TO:'Palmas'
    };

    // Preenche datalist com capitais (usado só no fallback)
    const dataList = document.getElementById('sugestoesCapitais');
    dataList.innerHTML = Object.values(CAPITAIS).map(c => `<option value="${c}">`).join('');

    const estadoEl     = document.getElementById('estado');
    const cidadeSelect = document.getElementById('cidadeSelect');
    const cidadeInput  = document.getElementById('cidadeInput');
    const cidadeStatus = document.getElementById('cidadeStatus');

    // fetch com timeout
    async function fetchWithTimeout(url, ms = 12000){
      const ctrl = new AbortController();
      const to = setTimeout(()=>ctrl.abort(), ms);
      try{
        return await fetch(url, { signal: ctrl.signal, mode:'cors', cache:'no-store' });
      } finally {
        clearTimeout(to);
      }
    }

    function preparandoLoad(){
      cidadeStatus.textContent = 'Carregando cidades…';
      cidadeSelect.innerHTML = '<option value="">Carregando…</option>';
      cidadeSelect.disabled = true;
      cidadeSelect.classList.remove('hidden');
      cidadeInput.classList.add('hidden');
    }

    function preencherSelect(nomes){
      cidadeSelect.innerHTML = '<option value="">Selecione a cidade</option>' +
        nomes.map(n=>`<option value="${n}">${n}</option>`).join('');
      cidadeSelect.disabled = false;
      cidadeStatus.textContent = '';
      cidadeSelect.classList.remove('hidden');
      cidadeInput.classList.add('hidden');
    }

    function usarInputManual(msg){
      cidadeSelect.classList.add('hidden');
      cidadeSelect.disabled = true;
      cidadeInput.classList.remove('hidden');
      cidadeInput.value = '';
      cidadeInput.placeholder = 'Digite sua cidade (ex.: ' + (CAPITAIS[estadoEl.value] || 'sua cidade') + ')';
      cidadeStatus.textContent = msg || '';
      cidadeInput.focus();
    }

    async function carregarCidades(uf){
      const id = UF_IDS[uf];
      if(!id){ usarInputManual('Estado inválido. Digite a cidade.'); return; }

      // Cache local por UF
      const cacheKey = 'cities_' + id + '_v3';
      const cached = localStorage.getItem(cacheKey);
      if(cached){
        try{
          const nomes = JSON.parse(cached);
          if(Array.isArray(nomes) && nomes.length){
            preencherSelect(nomes);
            return;
          }
        }catch{}
      }

      preparandoLoad();

      try{
        // 1ª tentativa (ordenado)
        let url = `https://servicodados.ibge.gov.br/api/v1/localidades/estados/${id}/municipios?orderBy=nome`;
        let res = await fetchWithTimeout(url, 12000);
        if(!res.ok){
          // 2ª tentativa (sem orderBy)
          url = `https://servicodados.ibge.gov.br/api/v1/localidades/estados/${id}/municipios`;
          res = await fetchWithTimeout(url, 12000);
        }
        if(!res.ok) throw new Error('HTTP ' + res.status);

        const data = await res.json();
        if(!Array.isArray(data)) throw new Error('Resposta inesperada');

        const nomes = data.map(m => m.nome).sort((a,b)=>a.localeCompare(b, 'pt-BR'));
        localStorage.setItem(cacheKey, JSON.stringify(nomes));
        preencherSelect(nomes);
      }catch(err){
        console.warn('Falha na busca de cidades do IBGE:', err);
        usarInputManual('Não foi possível carregar as cidades. Digite manualmente (sugestões de capitais disponíveis).');
      }
    }

    // Troca UF => carrega cidades
    estadoEl.addEventListener('change', ()=>{
      const uf = estadoEl.value;
      if(!uf){
        cidadeSelect.innerHTML = '<option value="">Selecione o estado primeiro</option>';
        cidadeSelect.disabled = true;
        cidadeSelect.classList.remove('hidden');
        cidadeInput.classList.add('hidden');
        cidadeStatus.textContent = '';
        return;
      }
      carregarCidades(uf);
    });

    function getCidadeValor(){
      return (!cidadeSelect.classList.contains('hidden') && !cidadeSelect.disabled && cidadeSelect.value)
        ? cidadeSelect.value
        : cidadeInput.value.trim();
    }

    function enviarWhatsApp(){
      const nome = document.getElementById('nome').value.trim();
      const escola = document.getElementById('escola').value.trim();
      const estado = estadoEl.value.trim();
      const cidade = getCidadeValor();
      const equipamento = document.getElementById('equipamento').value;
      const serie = document.getElementById('serie').value.trim();

      const msg = `*Novo Chamado*\n` +
                  `Nome: ${nome}\n` +
                  `Escola: ${escola}\n` +
                  `Cidade: ${cidade} - ${estado}\n` +
                  `Equipamento: ${equipamento}\n` +
                  `Nº de Série: ${serie}`;

      const url = `https://wa.me/5519981629450?text=${encodeURIComponent(msg)}`;
      window.open(url,'_blank');
    }

    // Se já vier com UF preenchido (autofill), carrega
    if(estadoEl.value){ carregarCidades(estadoEl.value); }
  </script>
</body>
</html>
