<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Help Amado — Início</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Plus+Jakarta+Sans:wght@600;800&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --laranja:#ff6b00; --roxo:#6a1b9a; --azul:#2563eb; --verde:#16a34a; --amarelo:#eab308;
      --cinza-claro:#f5f7fb; --texto:#1f2937; --borda:#e5e7eb; --card:#ffffff;
      --font-heading:'Plus Jakarta Sans',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial,sans-serif;
      --font-body:'Inter',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial,sans-serif;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:#fff;color:var(--texto);font-family:var(--font-body);line-height:1.55}

    /* Cabeçalho */
    header{background:#fff;position:sticky;top:0;z-index:50;border-bottom:1px solid var(--borda)}
    header::after{content:"";display:block;height:3px;background:linear-gradient(90deg,var(--roxo),var(--laranja),var(--azul),var(--verde),var(--amarelo),var(--roxo));background-size:300% 100%;animation:brandMove 12s linear infinite}
    .header-wrap{display:flex;align-items:center;justify-content:space-between;gap:16px;max-width:1200px;margin:0 auto;padding:14px 20px}
    .logo-text{font-family:var(--font-heading);font-weight:800;font-size:1.5rem;text-decoration:none;display:inline-flex;align-items:center}
    .logo-orange{color:var(--laranja)} .logo-purple{color:var(--roxo)}
    nav a{text-decoration:none;color:var(--texto);margin-left:18px;font-weight:600;opacity:.85;position:relative}
    nav a:hover{color:var(--laranja);opacity:1}
    nav a.active{color:var(--laranja)}
    nav a::after{content:"";position:absolute;left:0;bottom:-6px;height:2px;width:0;background:currentColor;transition:width .2s ease}
    nav a:hover::after,nav a.active::after{width:100%}

    /* Hero */
    .hero{position:relative;overflow:hidden;background:linear-gradient(120deg,#fff 0%,#fff 30%,#f8efff 60%,#fff 100%);padding:56px 20px}
    .hero::before{content:"";position:absolute;inset:-40%;background:
      radial-gradient(40% 30% at 20% 20%, rgba(106,27,154,.15), transparent 60%),
      radial-gradient(35% 25% at 80% 30%, rgba(255,107,0,.12), transparent 60%),
      radial-gradient(45% 35% at 50% 80%, rgba(37,99,235,.10), transparent 60%);animation:floatBg 16s linear infinite}
    @keyframes floatBg{0%{transform:translate3d(0,0,0)}50%{transform:translate3d(-5%, 3%, 0)}100%{transform:translate3d(0,0,0)}}
    .hero .wrap{max-width:1200px;margin:0 auto;text-align:center;position:relative}
    .hero h1{font:800 clamp(1.6rem,3.6vw,2.6rem)/1.1 var(--font-heading);color:var(--roxo);margin:0 0 10px}
    .hero p{margin:0 0 16px;opacity:.9}
    .actions{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid transparent;cursor:pointer;font-weight:800;text-decoration:none;transition:transform .15s ease,filter .15s ease}
    .btn:active{transform:scale(.98)} .btn-primary{background:var(--laranja);color:#fff} .btn-primary:hover{filter:brightness(.96)}
    .btn-outline{background:#fff;color:var(--roxo);border-color:var(--roxo)} .btn-outline:hover{background:#f8f5ff}

    /* CTA flutuante -> Chat */
    .cta-suporte{position:fixed;right:18px;bottom:18px;z-index:60;background:linear-gradient(135deg,var(--laranja),var(--roxo));color:#fff;border-radius:999px;padding:12px 16px;font-weight:800;text-decoration:none;box-shadow:0 10px 30px rgba(0,0,0,.18);animation:pulse 2.4s ease-in-out infinite}
    @keyframes pulse{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}

    .container{max-width:1200px;margin:0 auto;padding:28px 18px 60px}
    .section-title{text-align:center;color:var(--roxo);font:800 clamp(1.3rem,3vw,1.9rem)/1 var(--font-heading);margin:22px 0 26px}

    /* Ribbon */
    .ribbon{background:linear-gradient(90deg,var(--azul),var(--verde),var(--amarelo),var(--laranja),var(--roxo));background-size:300% 100%;animation:brandMove 16s linear infinite;border-radius:16px;padding:12px;margin:12px 0}
    .ribbon p{margin:0;text-align:center;color:#fff;font-weight:700}

    /* Equipamentos */
    .equip-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px}
    .equip{display:flex;align-items:center;gap:12px;padding:12px;border:1px solid var(--borda);border-radius:14px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.04);transition:transform .15s ease, box-shadow .15s ease}
    .equip:hover{transform:translateY(-2px);box-shadow:0 12px 20px rgba(0,0,0,.08)}
    .equip img{width:56px;height:56px;border-radius:12px;object-fit:cover;background:#f3f4f6;border:1px solid #e5e7eb}
    .equip h4{margin:0;font:800 .98rem/1.1 var(--font-heading);color:var(--roxo)}
    .equip p{margin:2px 0 0;font-size:.9rem;opacity:.85}
    .equip a{margin-left:auto;text-decoration:none;font-weight:800;color:var(--laranja)}

    /* Grid cards */
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:24px}
    .card{position:relative;display:flex;flex-direction:column;background:var(--card);border:1px solid var(--borda);border-radius:18px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,.04);transition:transform .18s ease,box-shadow .18s ease,border-color .18s ease}
    .card:hover{transform:translateY(-4px);box-shadow:0 18px 34px rgba(0,0,0,.10);border-color:#d7dce3}
    .card-media{background:#eef2f7;aspect-ratio:16/9;display:flex;justify-content:center;align-items:center}
    .card-media img{width:100%;height:100%;object-fit:cover}
    .card-body{padding:16px 18px 18px;display:flex;flex-direction:column;gap:10px;flex:1}
    .card-title{font:800 1.05rem/1.3 var(--font-heading);margin:0;color:var(--roxo)}
    .card-meta{margin-top:auto;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .badge{font-size:.72rem;font-weight:800;color:#4c1d95;background:#f3e8ff;border:1px solid #e9d5ff;border-radius:999px;padding:5px 10px}
    .btn-mini{padding:9px 12px;border-radius:10px;border:1px solid transparent;cursor:pointer;font-weight:800;text-decoration:none;background:var(--laranja);color:#fff;transition:transform .15s ease,filter .15s ease}
    .btn-mini:hover{filter:brightness(.96)} .btn-mini:active{transform:scale(.98)}
    .btn-download{padding:9px 12px;border-radius:10px;border:1px solid var(--roxo);background:#fff;color:#var(--roxo);text-decoration:none;font-weight:800}
    .btn-download:hover{background:#f8f5ff}

    .ripple{position:absolute;pointer-events:none;border-radius:9999px;transform:scale(0);opacity:.5;background:radial-gradient(circle, rgba(255,107,0,.35) 0%, rgba(106,27,154,.35) 70%, transparent 72%);animation:ripple .6s ease-out}
    @keyframes ripple{to{transform:scale(10);opacity:0}}

    /* Blog */
    .blog{margin-top:14px}
    .post-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:18px;margin-top:8px}
    .post{padding:16px;border:1px solid var(--borda);border-radius:14px;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.04);transition:transform .15s ease, box-shadow .18s ease;display:grid;gap:6px}
    .post:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(0,0,0,.08)}
    .post h4{margin:0;font:800 1rem/1.2 var(--font-heading);color:var(--roxo)}
    .post p{margin:0;opacity:.9}
    .post .meta{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
    .chip{font-size:.75rem;background:#f3e8ff;border:1px solid #e9d5ff;border-radius:999px;padding:4px 8px;font-weight:700;color:var(--roxo)}

    /* Rodapé */
    .site-footer{color:#fff;margin-top:40px;position:relative;overflow:hidden;background:linear-gradient(90deg,var(--roxo),var(--laranja),var(--azul),var(--verde),var(--amarelo),var(--roxo));background-size:300% 100%;animation:brandMove 16s linear infinite}
    .footer-wrap{max-width:1200px;margin:0 auto;padding:18px 20px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .site-footer p{margin:0;font-weight:600}
    @keyframes brandMove{0%{background-position:0% 50%}100%{background-position:300% 50%}}
    @media (prefers-reduced-motion:reduce){header::after,.site-footer,.hero::before{animation:none;background-position:50% 50%}}

    /* Modal */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:16px;z-index:60;backdrop-filter:saturate(1.1) blur(2px)}
    .overlay.open{display:flex}
    .modal{background:#fff;border:1px solid var(--borda);border-radius:16px;max-width:820px;width:min(96vw,820px);box-shadow:0 25px 60px rgba(0,0,0,.18);overflow:hidden;animation:pop .15s ease}
    .modal-header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 16px;border-bottom:1px solid var(--borda)}
    .modal-title{font:800 1.05rem/1.2 var(--font-heading);color:var(--roxo);margin:0}
    .modal-body{padding:16px 16px 18px;display:grid;gap:10px}
    .close{background:#fff;border:1px solid var(--borda);border-radius:10px;padding:8px 10px;font-weight:800;cursor:pointer}
    @keyframes pop{from{transform:translateY(6px);opacity:.0}to{transform:translateY(0);opacity:1}}

    /* ===================== CHATBOT ===================== */
    .cb{position:fixed;right:18px;bottom:90px;z-index:70;display:none}
    .cb.open{display:block}
    .cb-window{width:min(92vw,380px);height:520px;background:#fff;border:1px solid var(--borda);border-radius:16px;box-shadow:0 20px 50px rgba(0,0,0,.18);display:flex;flex-direction:column;overflow:hidden}
    .cb-header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:linear-gradient(90deg,var(--roxo),var(--laranja));color:#fff}
    .cb-title{font:800 1rem/1 var(--font-heading);display:flex;align-items:center;gap:8px}
    .cb-actions{display:flex;gap:8px}
    .cb-ico{background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.3);color:#fff;border-radius:10px;padding:6px 8px;font-weight:800;cursor:pointer}
    .cb-messages{flex:1;padding:12px;overflow:auto;background:linear-gradient(180deg,#ffffff 0%, #faf7ff 100%)}
    .cb-msg{display:flex;margin:8px 0;gap:8px;align-items:flex-start}
    .cb-msg.user .bubble{background:#e3f2ff;border:1px solid #cfe7ff;color:#0b2a55}
    .cb-msg.bot .bubble{background:linear-gradient(180deg,#f6f0ff,#fff);border:1px solid #eadcff}
    .bubble{padding:10px 12px;border-radius:12px;max-width:78%;box-shadow:0 2px 8px rgba(0,0,0,.04);white-space:pre-wrap}
    .avatar{width:26px;height:26px;border-radius:999px;display:grid;place-items:center;font-weight:800;color:#fff}
    .avatar.u{background:var(--azul)} .avatar.b{background:var(--roxo)}
    .cb-typing{font-size:.85rem;opacity:.7;margin:6px 12px}
    .cb-input{display:flex;gap:8px;padding:10px;border-top:1px solid var(--borda);background:#fff}
    .cb-input input{flex:1;padding:10px;border:1px solid var(--borda);border-radius:10px}
    .cb-input button{padding:10px 12px;border-radius:10px;border:1px solid transparent;background:var(--laranja);color:#fff;font-weight:800;cursor:pointer}
    @media (max-width:520px){ .cb-window{height:70vh} }
  </style>
</head>
<body>
  <header>
    <div class="header-wrap">
      <a href="index.html" class="logo-text" aria-label="Voltar para Início">
        <span class="logo-orange">Help</span> <span class="logo-purple">Amado</span>
      </a>
      <nav aria-label="Navegação principal">
        <a class="active" href="index.html" aria-current="page">Início</a>
        <a href="manuais.html">Manuais</a>
        <a href="suporte.html">Suporte</a>
        <a href="games.html">Games</a>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="wrap">
      <h1>Bem-vindos ao Help Amado</h1>
      <p>Projetos criativos e suporte técnico para transformar a aprendizagem na sua escola.</p>
      <div class="actions">
        <a class="btn btn-primary" href="manuais.html">Ver Manuais</a>
        <a class="btn btn-outline" href="suporte.html">Abrir Chamado</a>
      </div>
    </div>
  </section>

  <!-- Botão que abre o chat -->
  <a class="cta-suporte" href="#" id="ctaChat" title="Precisa de ajuda agora?">Precisa de Suporte?</a>

  <main class="container">
    <div class="ribbon"><p>Impressora 3D • Corte a Laser • Plotter • Telas Interativas • Notebooks</p></div>

    <h2 class="section-title">Equipamentos</h2>
    <section class="equip-grid" aria-label="Equipamentos">
      <article class="equip">
        <img src="imagens/Imagens impressora 3d.png" alt="Impressora 3D"/>
        <div>
          <h4>Impressora 3D</h4>
          <p>Modela e imprime peças para projetos.</p>
        </div>
        <a href="manuais.html#impressora3d">Manual</a>
      </article>
      <article class="equip">
        <img src="imagens/Corte a laser flow.png" alt="Corte a Laser"/>
        <div>
          <h4>Corte a Laser</h4>
          <p>Cortes/gravuras precisos em MDF/acrílico.</p>
        </div>
        <a href="manuais.html#laser">Manual</a>
      </article>
      <article class="equip">
        <img src="imagens/plotter de recorte.webp" alt="Plotter de Recorte"/>
        <div>
          <h4>Plotter de Recorte</h4>
          <p>Adesivos e sinalização escolar.</p>
        </div>
        <a href="manuais.html#plotter">Manual</a>
      </article>
      <article class="equip">
        <img src="imagens/D_NQ_NP_717598-MLB54926343763_042023-O-removebg-preview.png" alt="Tela Interativa"/>
        <div>
          <h4>Tela Interativa</h4>
          <p>Aulas dinâmicas e exposições digitais.</p>
        </div>
        <a href="manuais.html#tela">Manual</a>
      </article>
      <article class="equip">
        <img src="https://images.unsplash.com/photo-1498050108023-c5249f4df085?w=256&auto=format&fit=crop&q=70" alt="Notebook Amado"/>
        <div>
          <h4>Notebook Amado</h4>
          <p>Uso diário com software educacional.</p>
        </div>
        <a href="manuais.html#notebook">Manual</a>
      </article>
    </section>

    <h2 class="section-title">Ideias de Projetos Pedagógicos</h2>
    <section class="grid" aria-label="Ideias pedagógicas">
      <!-- exemplo de card; mantenha os demais como já estavam -->
      <article class="card" data-project="proj1" data-dl="downloads/projetos/chaveiro-acrilico.zip">
        <div class="card-media"><img src="imagens/ChatGPT Image 16 de ago. de 2025, 12_32_02.png" alt="Chaveiros em acrílico"/></div>
        <div class="card-body">
          <h3 class="card-title">Chaveiro em Acrílico</h3>
          <p>Identidade da turma e vetorização básica.</p>
          <div class="card-meta">
            <span class="badge">Corte a Laser</span>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="btn-mini" data-modal="proj1">Ver projeto</button>
              <a class="btn-download" href="downloads/projetos/chaveiro-acrilico.zip" download>Baixar Arquivo</a>
            </div>
          </div>
        </div>
      </article>
      <!-- ...demais cards iguais aos seus -->
    </section>

    <section class="blog">
      <h2 class="section-title">Assistência Técnica • Dicas Rápidas</h2>
      <div class="post-list">
        <article class="post">
          <h4>Checklist antes de imprimir em 3D</h4>
          <p>Temperatura, adesão, nivelamento e fatiamento.</p>
          <div class="meta"><span class="chip">Impressora 3D</span><span class="chip">5 min</span></div>
        </article>
        <article class="post">
          <h4>Parâmetros para MDF 3mm</h4>
          <p>Velocidade, potência e foco ideais.</p>
          <div class="meta"><span class="chip">Corte a Laser</span><span class="chip">3 min</span></div>
        </article>
        <article class="post">
          <h4>Vinil sem bolhas</h4>
          <p>Máscara, espátula e limpeza da superfície.</p>
          <div class="meta"><span class="chip">Plotter</span><span class="chip">4 min</span></div>
        </article>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="footer-wrap">
      <p>© 2025 Help Amado — Todos os direitos reservados.</p>
      <p>Laboratório de aprendizagem criativa • Escola & Pedagogia</p>
    </div>
  </footer>

  <!-- Modal de projetos -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">Projeto</h3>
        <button class="close" id="closeModal" aria-label="Fechar">Fechar</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

  <!-- ================= CHATBOT (programado, respostas limpas + follow-up) ================= -->
  <div class="cb" id="chatbot" aria-live="polite">
    <div class="cb-window">
      <div class="cb-header">
        <div class="cb-title">🤖 Chat Suporte</div>
        <div class="cb-actions">
          <button class="cb-ico" id="cbCloseBtn" title="Fechar">✖</button>
        </div>
      </div>
      <div class="cb-messages" id="cbMessages"></div>
      <form class="cb-input" id="cbForm">
        <input id="cbText" type="text" placeholder="Escreva sua pergunta..." autocomplete="off" />
        <button type="submit">Enviar</button>
      </form>
    </div>
  </div>

  <script>
    /* ========= Efeitos (Ripple) ========= */
    document.addEventListener('click', (e)=>{
      const card = e.target.closest('.card');
      if(!card) return;
      const r = document.createElement('span'); r.className='ripple';
      const rect = card.getBoundingClientRect(); const size = Math.max(rect.width, rect.height);
      r.style.width=r.style.height=size+'px'; r.style.left=(e.clientX-rect.left-size/2)+'px'; r.style.top=(e.clientY-rect.top-size/2)+'px';
      card.appendChild(r); setTimeout(()=>r.remove(),600);
    });

    /* ========= Modal Projetos ========= */
    const TPL = {
      proj1:`<div class="chips"><span class="chip">Corte a Laser</span><span class="chip">1–2 aulas</span></div><p><strong>Chaveiros em acrílico</strong> para trabalhar vetorização e segurança.</p><ol class="steps"><li>Desenho vetorial simples.</li><li>Definir corte/gravação.</li><li>Testar potência/velocidade.</li><li>Cortar e montar.</li></ol>`,
      // ... mantenha os demais TPL como já estavam no seu projeto
    };
    const TIT = {proj1:'Chaveiro em Acrílico'}; // idem acima

    const overlay = document.getElementById('overlay');
    const modalBody = document.getElementById('modalBody');
    const modalTitle = document.getElementById('modalTitle');
    function abrirModal(titulo, html, dlHref){
      modalTitle.textContent = titulo || 'Projeto';
      modalBody.innerHTML = `${html}<div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
        <a class="btn btn-primary" href="${dlHref||'#'}" ${dlHref?'download':''}>Baixar Arquivo</a>
        <button class="btn btn-outline" id="fecharModalInline">Fechar</button></div>`;
      overlay.classList.add('open'); overlay.setAttribute('aria-hidden','false');
      document.getElementById('fecharModalInline').onclick = ()=>fecharModal();
    }
    function fecharModal(){ overlay.classList.remove('open'); overlay.setAttribute('aria-hidden','true'); modalBody.innerHTML=''; }
    document.getElementById('closeModal').onclick = fecharModal;
    overlay.addEventListener('click',(e)=>{ if(e.target===overlay) fecharModal(); });
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape'&&overlay.classList.contains('open')) fecharModal(); });
    document.addEventListener('click',(e)=>{
      const btn=e.target.closest('button.btn-mini[data-modal]'); if(!btn) return; e.preventDefault();
      const id=btn.dataset.modal; const card=btn.closest('.card'); const dl=card?.getAttribute('data-dl')||'#';
      abrirModal(TIT[id]||'Projeto', TPL[id]||'', dl);
    });

    /* ========= Chat (programado) ========= */
    const cb = document.getElementById('chatbot');
    const cta = document.getElementById('ctaChat');
    const cbClose = document.getElementById('cbCloseBtn');
    const cbForm = document.getElementById('cbForm');
    const cbText = document.getElementById('cbText');
    const cbMessages = document.getElementById('cbMessages');

    function el(tag,cls,txt){ const e=document.createElement(tag); if(cls) e.className=cls; if(txt!=null) e.textContent=txt; return e; }
    function sanitize(s){ return (s||'').replace(/[&<>]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c])); }
    function addMsg(role, text){
      const row=el('div','cb-msg '+(role==='user'?'user':'bot'));
      const av=el('div','avatar '+(role==='user'?'u':'b'), role==='user'?'U':'B');
      const b=el('div','bubble'); b.innerHTML = sanitize(text).replace(/\n/g,'<br>');
      row.append(av,b);
      cbMessages.append(row);
      cbMessages.scrollTop=cbMessages.scrollHeight;
    }
    function addTyping(){ const r=el('div','cb-typing','Digitando…'); r.id='cbTyping'; cbMessages.append(r); cbMessages.scrollTop=cbMessages.scrollHeight; }
    function rmTyping(){ const t=document.getElementById('cbTyping'); if(t) t.remove(); }

    function openChat(){
      cb.classList.add('open');
      const greeted = sessionStorage.getItem('cb_greeted');
      if(!greeted){
        addMsg('bot','Bem-vindo ao Help Amado! Como posso te ajudar?');
        sessionStorage.setItem('cb_greeted','1');
      }
      setTimeout(()=>cbText.focus(), 50);
    }
    function closeChat(){ cb.classList.remove('open'); }
    cta.addEventListener('click', e=>{ e.preventDefault(); openChat(); });
    cbClose.addEventListener('click', closeChat);

    /* ========= Base de Conhecimento (respostas curtas, sem links) ========= */
    const KB = {
      impressora3d: {
        keywords: ["impressora 3d","3d","filamento","pla","abs","petg","nozzle","bico","extrusor","cura","fatiar","nivelar","bed"],
        faqs: [
          { q:["como nivelar a mesa","nivelamento da base","bed leveling","nivelar mesa"], a:
"Nivelamento rápido: pré-aqueça. Desative motores. Ajuste os 4 cantos com papel até atrito leve e repita no centro. Ajudou? Quer perguntar outra coisa?" },
          { q:["temperatura pla","configuração pla","parametros pla","qual temperatura imprimir pla"], a:
"PLA: bico 200–210 °C, mesa 55–60 °C, camada 0,2 mm, velocidade 40–60 mm/s, retração 0,8–1,2 mm a 25–35 mm/s. Ajudou? Quer perguntar outra coisa?" },
          { q:["filamento não sai","entupimento","nozzle entupido","sem extrudar"], a:
"Sem extrusão: confirme aquecimento, empurre filamento manualmente, faça cold pull, revise PTFE/drive e troque o bico se preciso. Ajudou? Quer perguntar outra coisa?" },
          { q:["peça soltando da mesa","warping","canto levantando","adesão fraca"], a:
"Adesão: limpe a mesa, use brim/raft, mesa a 60 °C, 1ª camada mais lenta e refaça o nivelamento. Ajudou? Quer perguntar outra coisa?" }
        ]
      },
      laser: {
        keywords: ["laser","corte a laser","mdf","acrilico","foco","potencia","velocidade","gravacao","exhaust","fumaca"],
        faqs: [
          { q:["parametros mdf 3mm","velocidade e potencia mdf","cortar mdf 3mm"], a:
"MDF 3 mm: corte 10–20 mm/s a 60–80% (1 passe). Gravação 300–500 mm/s a 15–25%. Faça testes. Ajudou? Quer perguntar outra coisa?" },
          { q:["como ajustar foco","altura do foco","focal distance"], a:
"Foco: use o gabarito, ajuste Z até encostar, remova e teste uma linha fina. Ajudou? Quer perguntar outra coisa?" },
          { q:["segurança laser","fumaca","exaustor"], a:
"Segurança: tampa fechada, exaustor ligado e nunca corte PVC. Ajudou? Quer perguntar outra coisa?" }
        ]
      },
      plotter: {
        keywords: ["plotter","vinil","lamina","offset","forca","pressao","svg","espelhar","adesivo"],
        faqs: [
          { q:["configurar força da lamina","força da lamina","pressao da lamina","nao corta vinil"], a:
"Lâmina 45°: força 80–120 g, velocidade 10–20 cm/s. Faça test cut até não marcar o liner. Ajudou? Quer perguntar outra coisa?" },
          { q:["espelhar para termotransfer","termotransfer","heat transfer","espelhar texto"], a:
"Termotransfer: ative espelhar, corte pelo verso, depile e aplique calor conforme a mídia. Ajudou? Quer perguntar outra coisa?" },
          { q:["exportar svg","tamanho no svg","arquivo para plotter"], a:
"Arquivo: SVG em mm, apenas curvas/traços, sem efeitos ou máscaras. Ajudou? Quer perguntar outra coisa?" }
        ]
      },
      tela: {
        keywords: ["tela","interativa","touch","hdmi","usb","calibrar","espelhar tela","som"],
        faqs: [
          { q:["sem toque","touch nao funciona","usb não reconhece"], a:
"Sem toque: conecte também o USB, troque a porta, reinicie e verifique o driver. Ajudou? Quer perguntar outra coisa?" },
          { q:["sem imagem","hdmi","fonte errada","entrada"], a:
"Sem imagem: confirme a entrada, teste outro cabo/porta e ajuste a resolução no PC. Ajudou? Quer perguntar outra coisa?" }
        ]
      },
      notebook: {
        keywords: ["notebook","wi-fi","rede","usuario","senha","atualizacao","bateria","desempenho"],
        faqs: [
          { q:["wi-fi nao conecta","sem internet","rede nao aparece"], a:
"Wi-Fi: esqueça e reconecte, confira hora/BIOS, atualize drivers e teste outro ponto de acesso. Ajudou? Quer perguntar outra coisa?" },
          { q:["lento","desempenho baixo","travando"], a:
"Desempenho: limpe inicialização, atualize sistema/drivers e libere espaço em disco. Ajudou? Quer perguntar outra coisa?" }
        ]
      }
    };

    const lastContext = { topic: null };

    function normalize(str){
      return (str||'')
        .toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
        .replace(/[^a-z0-9\s#@\-_.]/g,' ')
        .replace(/\s+/g,' ')
        .trim();
    }
    function tokens(str){ return normalize(str).split(' ').filter(Boolean); }

    function detectTopic(ntxt){
      let best = null, bestScore = 0;
      for (const id in KB){
        const kws = KB[id].keywords || [];
        let sc = 0;
        kws.forEach(k=>{ if(ntxt.includes(normalize(k))) sc += 1; });
        if (lastContext.topic === id) sc += 1.2;
        if (sc > bestScore){ bestScore = sc; best = id; }
      }
      return best;
    }

    function scoreFAQ(faq, ntxt){
      let max = 0;
      for (const variant of faq.q){
        const vtoks = tokens(variant);
        let hit = 0;
        vtoks.forEach(t=>{ if(ntxt.includes(t)) hit++; });
        const s = hit / Math.max(1, vtoks.length);
        if (s > max) max = s;
      }
      return max;
    }

    function answer(text){
      const ntxt = normalize(text);
      if (!ntxt){
        return "Não entendi. Pode detalhar? Ajudou? Quer perguntar outra coisa?";
      }

      // assunto
      let topic = detectTopic(ntxt);
      if (!topic){
        let guess = null, gScore = 0;
        for (const id in KB){
          for(const faq of KB[id].faqs){
            const s = scoreFAQ(faq, ntxt);
            if (s > gScore){ gScore = s; guess = id; }
          }
        }
        topic = guess;
      }
      if (!topic){
        return "Não encontrei algo para isso. Pode reformular? Ajudou? Quer perguntar outra coisa?";
      }

      // melhor FAQ
      const faqs = KB[topic].faqs;
      let best = null, bestScore = 0;
      faqs.forEach(f=>{
        const s = scoreFAQ(f, ntxt);
        if (s > bestScore){ bestScore = s; best = f; }
      });

      if (!best || bestScore < 0.3){
        return "Tenho informações sobre esse assunto, mas preciso de mais detalhes. Ajudou? Quer perguntar outra coisa?";
      }

      lastContext.topic = topic;
      return best.a; // cada resposta já termina com “Ajudou?...”
    }

    /* ========= Fluxo do chat ========= */
    const greetOnce = ()=> {
      const greeted = sessionStorage.getItem('cb_greeted');
      if(!greeted){
        addMsg('bot','Bem-vindo ao Help Amado! Como posso te ajudar?');
        sessionStorage.setItem('cb_greeted','1');
      }
    };

    document.addEventListener('click', function(e){
      const openBtn = e.target.closest('#ctaChat');
      const closeBtn = e.target.closest('#cbCloseBtn');
      if (openBtn) { e.preventDefault(); cb.classList.add('open'); greetOnce(); setTimeout(()=>cbText.focus(), 50); }
      if (closeBtn){ e.preventDefault(); cb.classList.remove('open'); }
    }, { passive:false });

    cbForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      const text = cbText.value.trim();
      if(!text) return;
      cbText.value = '';
      addMsg('user', text);
      addTyping();
      setTimeout(()=>{
        const resp = answer(text);
        rmTyping();
        addMsg('bot', resp);
      }, 150);
    });
  </script>
</body>
</html>
